<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Ideas for Improving Type Promotion in GHC</title>
        <link rel="stylesheet" href="../css/default.css" />
    </head>
    <body>
        <header>
            <div class="logo">
                <a href="../">Bj√∂rn Gohla</a>
            </div>
            <nav>
                <a href="../">Home</a>
                <a href="../about.html">About</a>
                <a href="../contact.html">Contact</a>
                <a href="../archive.html">Archive</a>
            </nav>
        </header>

        <main role="main">
            <h1>Ideas for Improving Type Promotion in GHC</h1>
            <article>
    <section class="header">
        Posted on July 19, 2022
        
    </section>
    <section>
        <p>Problem: Few base types can be promoted. I.e. <code>Natural</code> to <code>Nats</code> and
<code>Text</code> to <code>Symbol</code>.</p>
<p>TODO look up how type promotion for <code>Symbol</code> and <code>Nat</code> is actually
implemented.</p>
<p>If, as an example, we wanted to implement promoted <code>ByteString</code>s, we
could define them as lists of bytes. But bytes would have to be built
from ADTs.</p>
<p>E.g.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Byte</span> <span class="ot">=</span> <span class="dt">Byte</span> <span class="dt">Nibble</span> <span class="dt">Nibble</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Nibble</span> <span class="ot">=</span> <span class="dt">Nibble</span> <span class="dt">Bool</span> <span class="dt">Bool</span> <span class="dt">Bool</span> <span class="dt">Bool</span></span></code></pre></div>
<p>Then</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">ByteString'</span> <span class="ot">=</span> <span class="dt">ByteString'</span> [<span class="dt">Byte</span>]</span></code></pre></div>
<p>is promotable.</p>
<p>(This is presumably because we now have a purely inductive type.)</p>
<p>Now we need to establish the promotion/demotion relation such that
<code>Demote ByteString'</code> is <code>ByteString</code>.</p>
<p>The singletons library can presumably be easily extended to say
this. We would need to supply an isomorphism <code>ByteString'</code> -&gt;
<code>ByteString</code>.</p>
<p>How do we promote functions now? <code>ByteString</code> appearing in a function
signature would need to be <code>ByteString'</code> in the promoted kind
signature.</p>
<p>We need to establish <code>Sing ByteString</code> = <code>Sing ByteString'</code>?</p>
<p>The above mentioned isomorphism would be used to implement the
<code>SingKind ByteString'</code> instance.</p>
<p>Problem: How do we write promoted constants? The promoted constructors
are of course available, but might be awkward.</p>
<p>Problem: Presumably none of the native functions operating on
<code>ByteString</code>f can be promoted.</p>
<p>A lot can probably be done just using isomorphic ADTs. (Actually the
isomorphism question could be tricky, e.g., for <code>Int</code>)</p>
    </section>
</article>

        </main>

        <footer>
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </footer>
    </body>
</html>
